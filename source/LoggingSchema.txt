.. module:: LoggingSchema

Logging Schema
==============

:Revisions:
  ======== ============================================================
  Date     Comment
  ======== ============================================================
  20100210 (M.J.) First draft 
  ======== ============================================================


This schema for logging documents specifies the information returned by 
DataONE when requests for logs have been made from either Coordinating 
Nodes or Member Nodes.  The log information is maintained dynamically by
both the Coordinating Nodes and Member Nodes whenever a significant event
occurs for a tracked object in the system.  Tracked objects include all data
objects and science metadata objects in the system.  Events of significance
include the insertion, update, deletion, or reading of these objects.

Log data are considered operational information needed to run DataONE, and can
be read by all coordinating nodes in the course of service provision. In order
to reduce issues with third-party tracking of data status information, users can
read log information for an object if they have the access rights to read the
corresponding object on which the event was logged.


The following list of fields represents the set of information returned
upon a request for logging.

.. table:: 
   **Table 1.** Quick reference to the Logging fields described in
   more detail below.

  ================ =============================== ================= ===========
  Group            Field                           Type              Cardinality
  ================ =============================== ================= ===========
  Log              \                               \                 \
  \                :attr:`EntryId`                 IdentifierType    1
  \                :attr:`Identifier`              IdentifierType    1
  \                :attr:`IPAddress`               String            1
  \                :attr:`Principal`               PrincipalType     1
  \                :attr:`Event`                   EventType         1
  \                :attr:`LogDate`                 DateTime          1
  ================ =============================== ================= ===========

Logging Types
-------------

.. attribute:: IdentifierType

  IdentifierValue consisting of Unicode text excluding reserved characters 
  (whitespace and other characters to be determined)

.. attribute:: PrincipalType

  Person (user), group, or organization.
  
  PrincipalIdentifier drawn from the DataONE IdentityProviderService/

.. attribute:: EventType

  The contolled list of events that are logged, which will include 'INSERT',
  'UPDATE', 'DELETE', 'READ' events

Logging fields
--------------

.. attribute:: EntryId

  The identifier of a particular log record, used to differentiate it from
  other log records on the same objects.

  :Cardinality:
    1

  :ValueSpace:
    IdentifierType

  :Generated By: Node
  
  :Required Version: 0.3


.. attribute:: Identifier

  The identifier of the object on which a logged event occurred.

  :Cardinality:
    1

  :ValueSpace:
    IdentifierType

  :Generated By: Node
  
  :Required Version: 0.3


.. attribute:: LogDate

  Date and time (UTC) that the event was logged in the DataONE system.

  :Cardinality:
    1

  :ValueSpace:
    ISO 8601 Date-time value in UTC

  :Generated By: Node

  :Required Version: 0.3


.. attribute:: IPAddress

  The InternetProtocol address from which an originating event request
  originated.

  :Cardinality:
    1

  :ValueSpace:
    Internet IP address in either IP4 or IP6 syntax

  :Generated By: Node

  :Required Version: 0.3


.. attribute:: Event

  The type of event that was logged, such as an object insertion or
  deletion.

  :Cardinality:
    1

  :ValueSpace:
    EventType

  :Generated By: Node

  :Required Version: 0.3


.. attribute:: Principal

  Principal who generated the event through a request to the node. If the
  event was recorded without identifying the principal, then the principal
  will be recorded as 'public'.

  :Cardinality:
    1

  :ValueSpace:
    PrincipalType

  :Generated By: Node

  :Required Version: 0.3


Example Log Instance Document
------------------------------

The example instance document included here was auto-generated so does not
include useful values. It is included here to provide a general indication as
to the structure of a populated log document.

.. literalinclude:: schemas/log_instance_example.xml
   :language: xml
